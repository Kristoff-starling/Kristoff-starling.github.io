---
title: "问题求解 II - Final 题解"
linktitle: 'II-Final Sol'
type: docs
date: '2020-12-13T00:00:00Z'
draft: false

math: true

menu:
    oj-solutions:
        parent: Contents
        weight: 200
---

## A. 为世界所有美好而战

### 题面描述

- `yjher` 是一名带学生，他有一个梦想，为世界所有美好而战。作为带学生，他首先要解决一个问题，就是选课问题。俗话说，选课一时爽，期末火葬场，为了避免这种情况，他决定根据期末最后的总复习时间 $m$ 来确定选课方案。(每门课只能选一次）
- 已知现在一共有 $n$ 门课，每门课有两个属性 $v_i$ 和 $t_i$，分别表示这门课修完能获得的学分和复习需要花的时间。
- 现在问你复习所花时间的和不超过 $m$ 的情况下，能获得的最高分数。
- $n\leq 1000,m\leq 10^9,v_i\leq 300,t\leq 3e6$​​​。

<!--more-->

### 题解

由于 $m$ 的范围过大，而学分 $v_i$​​ 的范围相对较小，因此考虑将学分作为背包dp的状态。

令 $dp[i][j]$ 表示当前考虑到第 $i$ 门课，获得 $j$ 学分的情况下所需使用的最小时间，转移是简单的： $dp[i][j]=min\{dp[i-1][j],dp[i-1][j-v[i]]+t[i]\}$​​。

时间复杂度 $O(n\sum v_i)$，可以通过，但空间复杂度 $O(n\sum v_i)$​​ 不能接受。

背包dp有一种简单的空间优化的方式，考虑将dp状态压缩成一维 $dp[j]$，双重循环的第 $i$ 轮结束时表示获得 $j$ 学分所需的最小时间。我们只要在内循环中倒序循环，就能保证 $dp[j]$ 的更新来源都是上一层的数据，从而保证了正确性，这样空间复杂度压缩到 $O(\sum v_i)$​。

## B. 数列

### 题面描述

- 给定一个 $n$ 个数的数列 $a[i]$，对于每个 $i$ ,在右边找到一个最靠右的位置 $k$（即 $k$ 尽可能大），满足 $a[k]<a[i]$，输出 $k-i-1$，如果一个都找不到，输出 $-1$。对于序列的每个元素都要输出。
- $n\leq 500000$​。

### 题解

考虑按照权值从小到大的顺序向空序列中依次添加这些数，这样做的好处是，某一次添加 $a[i]$​ 时，数列中已经存在的数一定是比当前数小的数，因此我们只需要一边加数，一边更新下标的最大值即可。（如果下标最大值小于当前数的下标，则答案为-1）。

总时间复杂度 $O(nlogn)$​。

## C. 只有一种英雄主义

### 题面描述

- 这个世界上只有一种英雄主义，那就是在认清生活的真相后依然热爱它。`yjher` 面对着 $n$​​ 个生活的真相，这些生活的真相按序依次排好成为一个数列，`yjher` 对每个生活的真相都有 $m$​​ 种热爱等级可选（即可以理解为每个生活真相可以对应于一个 $1$​​ 到 $m$​​ 的热爱等级)。为了让生活看起来不要那么单调，要求相邻的生活真相有不同热爱等级（即如果你在第 $i$​​ 个生活真相中热爱等级是5，那么第 $i+1$​​ 个生活真相的热爱等级就不能是5），且 `yjher` 比较偏好数字 $k$​​，他希望所有生活真相总共使用的热爱等级数为恰好 $k$​​ 个。（就比如 $k=3,n=5,m=4$​​，那么 $1,2,3,2,1$​​ 和 $2,3,4,3,2$​​ 就是两个可行方案，但是 $1,2,3,4,3$​​​ 就不是，因为他用了超过3个不同的热爱等级）。

    现在问你所有可行的方案数。两个方案数认为是不同的，当前仅当两个方案的某个生活真相有不同的热爱等级（就比如 $1,2,3$ 和 $2,3,4$ 就是不同的方案），因为答案可能很大，令答案对 $1e9+7$取模。
- $n,m\leq 10^9,k\leq 10^6$​。

### 题解

首先从 $m$ 个等级中选出 $k$ 个来进行安排，这一部分的方案数是 $\binom{m}{k}$，之后的计算默认可选的等级为 1~k。

恰好选满了 $k$​ 种等级较难控制，考虑容斥。令 $C(i)$​ 表示在 $k$​ 种等级的其中 $i$​ 种的范围中进行选择的方案数。为了保证相邻不相同的约束，第一个真相有 $i$​ 种选择，后面每一种都只有 $i-1$​ 种选择，因此 $C(i)=i\cdot (i-1)^{n-1}$​。

根据容斥原理，

$$\begin{align*}ans &= \binom mk\sum_{i=0}^{n-2}(-1)^i\sum_{1\leq a_1,a_2,...,a_{k-i}\leq k}C(a_1,a_2,...,a_{k-i}) \\\\ &= \binom mk \sum_{i=0}^{n-2}(-1)^i\binom kiC(i) \\\\ &= \binom mk\sum_{i=0}^{n-2}(-1)^i\binom ki(k-i)(k-i-1)^{n-1} \end{align*}$$$\binom mk$ 可以通过下降幂的方式 $O(k)$ 地计算。预处理阶乘及其逆元之后，循环内部的组合数可以 $O(1)$ 计算， $(k-i-1)^{n-1}$ 需要使用快速幂，综上，总时间复杂度为 $O(klogn)$​。

