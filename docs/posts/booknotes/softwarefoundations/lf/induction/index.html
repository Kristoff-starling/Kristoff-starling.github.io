<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Yuyao Wang">

  
  
  
    
  
  <meta name="description" content="Separate Compilation Proof by Induction Proofs Within Proofs Formal vs. Informal Proof Exercises Exercise: 2 stars, standard, especially useful (basic_induction) Exercise: 2 stars, standard (double_plus) Exercise: 2 stars, standard (eqb_refl) Exercise: 2 stars, standard, optional (even_S) Exercise: 3 stars, standard, especially useful (mul_comm) Exercise: 2 stars, standard, optional (plus_leb_compat_l) Exercise: 3 stars, standard, optional (more_exercises) Exercise: 2 stars, standard, optional (add_shuffle3&rsquo;) Exercise: 3 stars, standard, especially useful (binary_commute) Exercise: 3 stars, standard (nat_bin_nat) Exercise: 2 stars, advanced (double_bin) Exercise: 4 stars, advanced (bin_nat_bin) Separate Compilation 如果想在新的 .">

  
  <link rel="alternate" hreflang="en-us" href="https://kristoff-starling.github.io/posts/booknotes/softwarefoundations/lf/induction/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="https://kristoff-starling.github.io/posts/booknotes/softwarefoundations/lf/induction/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Academic">
  <meta property="og:url" content="https://kristoff-starling.github.io/posts/booknotes/softwarefoundations/lf/induction/">
  <meta property="og:title" content="Proof by Indution | Academic">
  <meta property="og:description" content="Separate Compilation Proof by Induction Proofs Within Proofs Formal vs. Informal Proof Exercises Exercise: 2 stars, standard, especially useful (basic_induction) Exercise: 2 stars, standard (double_plus) Exercise: 2 stars, standard (eqb_refl) Exercise: 2 stars, standard, optional (even_S) Exercise: 3 stars, standard, especially useful (mul_comm) Exercise: 2 stars, standard, optional (plus_leb_compat_l) Exercise: 3 stars, standard, optional (more_exercises) Exercise: 2 stars, standard, optional (add_shuffle3&rsquo;) Exercise: 3 stars, standard, especially useful (binary_commute) Exercise: 3 stars, standard (nat_bin_nat) Exercise: 2 stars, advanced (double_bin) Exercise: 4 stars, advanced (bin_nat_bin) Separate Compilation 如果想在新的 ."><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>Proof by Indution | Academic</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Academic</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Academic</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/literature"><span>Literature</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/posts/booknotes/softwarefoundations/lf/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/posts/booknotes/softwarefoundations/lf/basics/">Chapters</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/posts/booknotes/softwarefoundations/lf/basics/">01: Basics</a>
      </li>
      
      <li class="active">
        <a href="/posts/booknotes/softwarefoundations/lf/induction/">02: Induction</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-9 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>Proof by Indution</h1>

          <div class="article-style">
            <ul>
<li>
<a href="#separate-compilation">Separate Compilation</a></li>
<li>
<a href="#proof-by-induction">Proof by Induction</a></li>
<li>
<a href="#proofs-within-proofs">Proofs Within Proofs</a></li>
<li>
<a href="#formal-vs-informal-proof">Formal vs. Informal Proof</a></li>
<li>
<a href="#exercises">Exercises</a>
<ul>
<li>
<a href="#exercise-2-stars-standard-especially-useful-basic_induction">Exercise: 2 stars, standard, especially useful (basic_induction)</a></li>
<li>
<a href="#exercise-2-stars-standard-double_plus">Exercise: 2 stars, standard (double_plus)</a></li>
<li>
<a href="#exercise-2-stars-standard-eqb_refl">Exercise: 2 stars, standard (eqb_refl)</a></li>
<li>
<a href="#exercise-2-stars-standard-optional-even_s">Exercise: 2 stars, standard, optional (even_S)</a></li>
<li>
<a href="#exercise-3-stars-standard-especially-useful-mul_comm">Exercise: 3 stars, standard, especially useful (mul_comm)</a></li>
<li>
<a href="#exercise-2-stars-standard-optional-plus_leb_compat_l">Exercise: 2 stars, standard, optional (plus_leb_compat_l)</a></li>
<li>
<a href="#exercise-3-stars-standard-optional-more_exercises">Exercise: 3 stars, standard, optional (more_exercises)</a></li>
<li>
<a href="#exercise-2-stars-standard-optional-add_shuffle3">Exercise: 2 stars, standard, optional (add_shuffle3&rsquo;)</a></li>
<li>
<a href="#exercise-3-stars-standard-especially-useful-binary_commute">Exercise: 3 stars, standard, especially useful (binary_commute)</a></li>
<li>
<a href="#exercise-3-stars-standard-nat_bin_nat">Exercise: 3 stars, standard (nat_bin_nat)</a></li>
<li>
<a href="#exercise-2-stars-advanced-double_bin">Exercise: 2 stars, advanced (double_bin)</a></li>
<li>
<a href="#exercise-4-stars-advanced-bin_nat_bin">Exercise: 4 stars, advanced (bin_nat_bin)</a></li>
</ul>
</li>
</ul>
<h2 id="separate-compilation">Separate Compilation</h2>
<p>如果想在新的 <code>.v</code> 文件中使用别的文件中的所有定义和定理 (比如 <code>Basics.v</code>)，可以使用如下语句：</p>
<pre><code class="language-plaintext">From LF Require Export Basics.
</code></pre>
<p>使用这条语句的前置条件是 Coq 可以在有 &ldquo;LF&rdquo; 前缀的目录下找到编译过的 <code>Basics.vo</code>。<code>.vo</code> 文件之于 <code>.v</code> 文件就好比 <code>.o</code> 文件之于 <code>.c</code> 文件。我们应当在当前的工作目录下建立 <code>_CoqProject</code> 文件，在其中写上</p>
<pre><code class="language-plaintext">-Q . LF
</code></pre>
<p>这会将当前目录绑定到 &ldquo;LF&rdquo; 前缀上。之后我们可以用</p>
<pre><code class="language-bash">coq_makefile -f _CoqProject *.v -o Makefile
</code></pre>
<p>来自动生成用于编译工作目录下所有源文件的 Makefile，并通过</p>
<pre><code class="language-bash">make Basics.vo
</code></pre>
<p>来编译生成 <code>.vo</code> 文件。</p>
<h2 id="proof-by-induction">Proof by Induction</h2>
<p>我们之前证明了 0 是 &ldquo;+&rdquo; 的 neutral element，但我们只证明了 0 在左侧的情况，即 <code>forall n : nat, 0 + n = n.</code>。如果我们要证明 <code>n + 0 = n</code>，事情便变得复杂起来：因为我们的加法是通过对第一个加数的递归定义的，未知大小的整数 <code>n</code> 无法递归。在这里我们必须使用归纳法 (induction)。</p>
<p>我们先直接给出归纳法证明 <code>n + 0 = n</code> 的步骤：</p>
<pre><code class="language-plaintext">Theorem add_0_r: forall n : nat, n + 0 = n.
Proof.
  intros n. induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite -&gt; IHn'.
    reflexivity.
Qed.
</code></pre>
<p><code>induction</code> 和 <code>destruct</code> 这个 tactic 一样，也可以在后面跟一个 as。第一种情况是令 <code>n = 0</code>，这种情况没有参数，所以 <code>|</code> 左侧没有东西；第二种情况是令 <code>n = S n'</code>，基于的假设是 <code>n' + 0 = n'</code> ，我们给这个假设命名为 <code>IHn'</code>。</p>
<h2 id="proofs-within-proofs">Proofs Within Proofs</h2>
<p>我们进行大的证明的过程中时常需要一些小的结论。我们可以在证明大定理之前把小结论先证明好，然后在大定理中 rewrite。但有时候有一些杂项的、trivial 的结论单独拎出来给证明会使证明过程变得很繁杂，所以 Coq 提供了在证明内部证明另一个命题的语法。下面是一个例子：</p>
<pre><code class="language-plaintext">Theorem mult_0_plus' forall n m : nat, (n + 0 + 0) * m = n * m.
Proof.
  intros n m.
  assert (H: n + 0 + 0 = n).
    { rewrite add_comm. simpl. rewrite add_comm. reflexivity. }
  rewrite -&gt; H.
  reflexivity.
Qed.
</code></pre>
<p><code>assert</code> 这个 tactic 会引入两个 subgoal：</p>
<ul>
<li>第一个 subgoal 是括号内写出的命题。上述的写法给这个命题命名为 H。我们也可以使用 <code>assert (n + 0 + 0 = n) as H.</code> 的语法来书写这一行。这个命题的证明用一对 <code>{}</code> 框起来。</li>
<li>第二个 subgoal 和 assert 之前的一刻的 goal 相同，但多了 assert 证明的结论作为一条假设。</li>
</ul>
<p>下面展示另一个需要使用 <code>assert</code> 的有趣的场景：</p>
<pre><code class="language-plaintext">Theorem plus_rearrange: forall n m p q : nat, (n + m) + (p + q) = (m + n) + (p + q).
Proof.
  intros n m p q.
  assert (H: n + m = m + n)
    { rewrite add_comm. reflexivity. }
  rewrite H.
  reflexivity.
Qed.
</code></pre>
<p>可以看到要证明的命题中只有第一个括号内两个加数的顺序不同。但可惜的是我们不能直接利用加法的交换律来 <code>rewrite</code>，因为 Coq 根据加法交换律在 goal 中寻找实例时会优先找到外层括号的实例，即会把两个括号的内容整体调换。在这里我们不利用加法交换律 rewrite，而是先证明 <code>n + m = m + n</code> 然后直接 rewrite。</p>
<h2 id="formal-vs-informal-proof">Formal vs. Informal Proof</h2>
<p>Formal proof 指的是写给 Coq 等证明工具看的证明过程；Informal proof 指的是用自然语言写给人看的证明过程。一个好的 formal proof 应当通过适当的注释和缩进来使其对人类也比较友好。通常来说，formal proof 在细节处会写得比 informal proof 更详细 (例如 reflexivity)，informal proof 会通过一些语言让读者更好地了解当前地证明状态 (这些信息只有使用 Coq 执行代码时才会显示出来)。</p>
<h2 id="exercises">Exercises</h2>
<h3 id="exercise-2-stars-standard-especially-useful-basic_induction">Exercise: 2 stars, standard, especially useful (basic_induction)</h3>
<pre><code class="language-plaintext">Theorem mul_0_r : forall n:nat,
  n * 0 = 0.
Proof.
  intros n. induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite -&gt; IHn'.
    reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Theorem plus_n_Sm : forall n m : nat,
  S (n + m) = n + (S m).
Proof.
  intros n m. induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite -&gt; IHn'.
    reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Theorem add_comm : forall n m : nat,
  n + m = m + n.
Proof.
  intros n m. induction n as [| n' IHn'].
  - rewrite -&gt; add_0_r. 
    reflexivity.
  - rewrite &lt;- plus_n_Sm.
    rewrite &lt;- IHn'.
    reflexivity.
Qed.
</code></pre>
<p>这个证明稍微复杂一些，归纳基础和归纳步骤都需要使用之前证明过的定理。</p>
<pre><code class="language-plaintext">Theorem add_assoc : forall n m p : nat,
  n + (m + p) = (n + m) + p.
Proof.
  intros n m p. induction n as [| n' IHn'].
  - reflexivity.
  - simpl. 
    rewrite -&gt; IHn'.
    reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-standard-double_plus">Exercise: 2 stars, standard (double_plus)</h3>
<pre><code class="language-plaintext">Lemma double_plus : forall n, double n = n + n .
Proof.
  intros n. induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite -&gt; IHn'.
    rewrite &lt;- plus_n_Sm.
    reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-standard-eqb_refl">Exercise: 2 stars, standard (eqb_refl)</h3>
<pre><code class="language-plaintext">Theorem eqb_refl : forall n : nat,
  (n =? n) = true.
Proof.
  intros n. induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite -&gt; IHn'.
    reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-standard-optional-even_s">Exercise: 2 stars, standard, optional (even_S)</h3>
<pre><code class="language-plaintext">Theorem even_S : forall n : nat,
  even (S n) = negb (even n).
Proof.
  intros n. induction n as [| n' IHn'].
  - reflexivity.
  - rewrite -&gt; IHn'.
    simpl.
    rewrite -&gt; negb_involutive.
    reflexivity.
Qed.
</code></pre>
<p>本题需要注意的点是：归纳步骤中如果直接上 <code>simpl</code> 化简，会将等式右侧的 <code>even n'</code> 的定义展开，所以这里笔者先 <code>rewrite</code> 再 <code>simpl</code>。</p>
<h3 id="exercise-3-stars-standard-especially-useful-mul_comm">Exercise: 3 stars, standard, especially useful (mul_comm)</h3>
<pre><code class="language-plaintext">Theorem add_shuffle3 : forall n m p : nat,
  n + (m + p) = m + (n + p).
Proof.
  intros n m p.
  rewrite add_assoc.
  rewrite add_assoc.
  assert (H: n + m = m + n).
    { rewrite add_comm. reflexivity. }
  rewrite H.
  reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Lemma mult_n_0: forall n : nat, n * 0 = 0.
Proof.
  induction n as [| n' IHn'].
  - reflexivity.
  - simpl. rewrite IHn'. reflexivity.
Qed.

Lemma mult_n_Sm: forall n m : nat,
  n * (1 + m) = n + n * m.
Proof.
  intros n m.
  induction n as [| n' IHn'].
  - reflexivity.
  - assert (H1: S n' * (1 + m) = S m + n' * (1 + m)). { reflexivity. }
    rewrite H1.
    rewrite IHn'.
    assert (H2: S n' * m = m + n' * m). { reflexivity. }
    rewrite H2.
    simpl.
    rewrite add_shuffle3.
    reflexivity.
Qed.


Theorem mul_comm : forall m n : nat,
  m * n = n * m.
Proof.
  intros n m.
  induction n as [| n' IHn'].
  - rewrite mult_n_0. reflexivity.
  - simpl.
    rewrite mult_n_Sm.
    rewrite IHn'.
    reflexivity.
Qed.
</code></pre>
<p>这题相当有难度，需要先证明 <code>n * S m = n + n * m</code> 这个引理，中间反复的在局部使用乘法定义/加法交换律结合律比较搞心态。</p>
<h3 id="exercise-2-stars-standard-optional-plus_leb_compat_l">Exercise: 2 stars, standard, optional (plus_leb_compat_l)</h3>
<pre><code class="language-plaintext">Theorem plus_leb_compat_l : forall n m p : nat,
  n &lt;=? m = true -&gt; (p + n) &lt;=? (p + m) = true.
Proof.
  intros n m p H.
  induction p as [| p' IHp'].
  - simpl. rewrite H. reflexivity.
  - simpl. rewrite IHp'. reflexivity.
Qed.
</code></pre>
<h3 id="exercise-3-stars-standard-optional-more_exercises">Exercise: 3 stars, standard, optional (more_exercises)</h3>
<pre><code class="language-plaintext">Theorem leb_refl : forall n:nat,
  (n &lt;=? n) = true.
Proof.
  intros n.
  induction n as [| n' IHn'].
  - reflexivity.
  - simpl. rewrite IHn'. reflexivity.
Qed.

Theorem zero_neqb_S : forall n:nat,
  0 =? (S n) = false.
Proof.
  intros n.
  reflexivity.
Qed.

Theorem andb_false_r : forall b : bool,
  andb b false = false.
Proof.
  intros b.
  rewrite andb_commutative.
  reflexivity.
Qed

Theorem S_neqb_0 : forall n:nat,
  (S n) =? 0 = false.
Proof.
  intros n.
  reflexivity.
Qed.

Theorem mult_1_l : forall n:nat, 1 * n = n.
Proof.
  intros n.
  simpl.
  rewrite add_comm.
  reflexivity.
Qed.

Theorem all3_spec : forall b c : bool,
  orb
    (andb b c)
    (orb (negb b)
         (negb c))
  = true.
Proof.
  intros [] [].
  - reflexivity.
  - reflexivity.
  - reflexivity.
  - reflexivity.
Qed.

Theorem mult_plus_distr_r : forall n m p : nat,
  (n + m) * p = (n * p) + (m * p).
Proof.
  intros.
  rewrite mul_comm.
  induction p as [| p' IHp'].
  - rewrite mult_n_0. rewrite mult_n_0. reflexivity.
  - simpl.
    rewrite mult_n_Sm.
    rewrite mult_n_Sm.
    rewrite IHp'.
    rewrite add_assoc.
    rewrite add_assoc.
    assert (H1: n + m + n * p' = n + (m + n * p')). { rewrite add_assoc. reflexivity. }
    rewrite H1.
    assert (H2: m + n * p' = n * p' + m). { rewrite add_comm. reflexivity. }
    rewrite H2.
    rewrite add_assoc.
    reflexivity.
Qed.

Theorem mult_assoc : forall n m p : nat,
  n * (m * p) = (n * m) * p.
Proof.
  intros.
  induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite IHn'.
    rewrite mult_plus_distr_r.
    reflexivity.
Qed.
</code></pre>
<p>注：乘法分配律的证明由于涉及过多繁琐的加法交换律/结合律，不能保证过程的简洁性。</p>
<h3 id="exercise-2-stars-standard-optional-add_shuffle3">Exercise: 2 stars, standard, optional (add_shuffle3')</h3>
<pre><code class="language-plaintext">Theorem add_shuffle3' : forall n m p : nat,
  n + (m + p) = m + (n + p).
Proof.
  intros.
  rewrite add_assoc.
  rewrite add_assoc.
  replace (n + m) with (m + n).
  - reflexivity.
  - rewrite add_comm. reflexivity.
Qed.
</code></pre>
<p>使用 <code>replace</code> 这个 tactic 可以避免每次 assert 之后再 rewrite 新假设的繁琐过程。</p>
<h3 id="exercise-3-stars-standard-especially-useful-binary_commute">Exercise: 3 stars, standard, especially useful (binary_commute)</h3>
<pre><code class="language-plaintext">Theorem bin_to_nat_pres_incr : forall b : bin,
  bin_to_nat (incr b) = 1 + bin_to_nat b.
Proof.
  intros b. induction b as [| b' | b' IHb']. 
  - reflexivity.
  - simpl. rewrite add_comm. reflexivity.
  - simpl. rewrite IHb'. simpl. rewrite add_comm. reflexivity.
Qed.
</code></pre>
<p>这里值得一提的是：Coq 中只有基于结构的归纳法，只要变量类型是以 inductive 的形式定义的，我们都可以使用归纳法进行证明。之前的归纳法都针对自然数，这是因为自然数也是归纳定义的。这里的 <code>bin</code> 有三个归纳分支，写起来和自然数大同小异。</p>
<h3 id="exercise-3-stars-standard-nat_bin_nat">Exercise: 3 stars, standard (nat_bin_nat)</h3>
<pre><code class="language-plaintext">Fixpoint nat_to_bin (n:nat) : bin :=
  match n with
  | O =&gt; Z
  | S n' =&gt; incr(nat_to_bin(n'))
  end.
</code></pre>
<pre><code class="language-plaintext">Theorem nat_bin_nat : forall n, bin_to_nat (nat_to_bin n) = n.
Proof.
  intros. induction n as [| n' IHn'].
  - reflexivity.
  - simpl. 
    rewrite bin_to_nat_pres_incr.
    rewrite IHn'.
    reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-advanced-double_bin">Exercise: 2 stars, advanced (double_bin)</h3>
<pre><code class="language-plaintext">Lemma double_incr : forall n : nat, double (S n) = S (S (double n)).
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Definition double_bin (b:bin) : bin :=
  match b with
  | Z =&gt; Z
  | _ =&gt; B0 b
  end.
</code></pre>
<pre><code class="language-plaintext">Example double_bin_zero : double_bin Z = Z.
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Lemma double_incr_bin : forall b,
    double_bin (incr b) = incr (incr (double_bin b)).
Proof.
  intros b.
  induction b as [| b' | b' IHb'].
  - reflexivity.
  - reflexivity.
  - reflexivity.
Qed.
</code></pre>
<h3 id="exercise-4-stars-advanced-bin_nat_bin">Exercise: 4 stars, advanced (bin_nat_bin)</h3>
<pre><code class="language-plaintext">Fixpoint normalize (b:bin) : bin :=
  match b with
  | Z =&gt; Z
  | B0 b' =&gt;
    match bin_to_nat b' with
    | 0 =&gt; Z
    | S n' =&gt; B0 (normalize b')
    end
  | B1 b' =&gt; B1 (normalize b')
  end.

Example normalize_example : normalize (B1 (B0 Z)) = B1 Z.
Proof. reflexivity. Qed.
</code></pre>
<p>书中提到的 &ldquo;equivalent&rdquo; bin 实质上指的就是前导 0 的问题，normalize 的主要任务是去除掉 <code>B0 (B0 ... Z)</code> 的情况，因此对 <code>B0 b'</code> 的情况进行特殊判断。</p>
<p>这里利用了 <code>bin_to_nat b'</code> 的结果判断是否是 0 而没有直接用 <code>normalize b'</code> 的结果，是为了下面证明的方便。下面的证明中对 <code>bin_to_nat b'</code> 的结果进行了分类讨论，这样定义可以让 <code>simpl</code> 直接拆解定义。</p>
<pre><code class="language-plaintext">Lemma mult_2_plus_1_bin : forall n : nat, nat_to_bin(n * 2 + 1) = B1 (nat_to_bin n).
Proof.
  intros n.
  induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite IHn'.
    reflexivity.
Qed.

Lemma mult_2_eq_double : forall n : nat, nat_to_bin (n * 2) = double_bin (nat_to_bin n).
Proof.
  intros n.
  induction n as [| n' IHn'].
  - reflexivity.
  - simpl.
    rewrite IHn'.
    rewrite double_incr_bin.
    reflexivity.
Qed.

Lemma double_bin_eq_B0 : forall b : bin, double_bin (incr b) = B0 (incr b).
Proof.
  intros b.
  destruct b as [| b' | b'] eqn:B.
  - reflexivity.
  - reflexivity.
  - reflexivity.
Qed.

Lemma mult_2_bin : forall n : nat, nat_to_bin (S n * 2) = B0 (nat_to_bin (S n)).
Proof.
  intros n.
  simpl.
  rewrite mult_2_eq_double.
  rewrite &lt;- double_incr_bin.
  rewrite double_bin_eq_B0.
  reflexivity.
Qed.

Theorem bin_nat_bin : forall b, nat_to_bin (bin_to_nat b) = normalize b.
Proof.
  intros b. induction b as [| b' | b' IHb'].
  - reflexivity.
  - destruct (bin_to_nat b') as [| n'] eqn:N.
    + simpl. rewrite N. reflexivity.
    + simpl. rewrite N. 
      rewrite &lt;- IHb'.
      rewrite mult_2_bin.
      reflexivity.
  - simpl.
    rewrite &lt;- IHb'.
    rewrite mult_2_plus_1_bin.
    reflexivity.
Qed.
</code></pre>
<p>为了证明最终的定理，笔者先证明了 3 个引理，主要围绕着 <code>*2</code>/<code>*2+1</code> 和在 bin前面添加 B0/B1 的一致性讨论。最终定理的证明中比较精妙的部分是关于 <code>bin_to_nat b'</code> 的讨论。在归纳步骤中等式右边是 <code>normalize (B0 b')</code>，如果我们不能确定 <code>b'</code> 不是 Z，那么括号里的 B0 就提不出来，可如果对着 b&rsquo; 的结构直接进行讨论，又容易陷入循环论证 (如果 <code>b'= B0 b''</code>，仍然说明不了问题)，因此在这里选择对 b&rsquo; 转化成自然数后的结果进行讨论。</p>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/posts/booknotes/softwarefoundations/lf/basics/" rel="next">Functional Programming in Coq</a>
  </div>
  
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on Jan 1, 0001</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/posts/BookNotes/SoftwareFoundations/lf/induction.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.f8eb5cb10262ef4a670903a5cb3e03ae.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
