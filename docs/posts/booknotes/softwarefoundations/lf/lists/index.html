<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Yuyao Wang">

  
  
  
    
  
  <meta name="description" content="Pairs of Numbers Lists of Numbers Repeat Length Append Head ant Tail Bags via Lists Reasoning About Lists Induction on Lists Reversing a List Search Options Partial Maps Exercises Exercise: 1 star, standard (snd_fst_is_swap) Exercise: 1 star, standard, optional (fst_swap_is_snd) Exercise: 2 stars, standard, especially useful (list_funs) Exercise: 3 stars, advanced (alternate) Exercise: 3 stars, standard, especially useful (bag_functions) Exercise: 3 stars, standard, optional (bag_more_functions) Exercise: 2 stars, standard, especially useful (add_inc_count) Exercise: 3 stars, standard (list_exercises) Exercise: 2 stars, standard (eqblist) Exercise: 1 star, standard (count_member_nonzero) Exercise: 3 stars, advanced (remove_does_not_increase_count) Exercise: 3 stars, standard, optional (bag_count_sum) Exercise: 3 stars, advanced (involution_injective) Exercise: 2 stars, advanced (rev_injective) Exercise: 2 stars, standard (hd_error) Exercise: 1 star, standard, optional (option_elim_hd) Exercise: 1 star, standard (eqb_id_refl) Exercise: 1 star, standard (update_eq) Exercise: 1 star, standard (update_neq) Pairs of Numbers 我们可以定义一个 pair 类型：">

  
  <link rel="alternate" hreflang="en-us" href="https://kristoff-starling.github.io/posts/booknotes/softwarefoundations/lf/lists/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="https://kristoff-starling.github.io/posts/booknotes/softwarefoundations/lf/lists/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Academic">
  <meta property="og:url" content="https://kristoff-starling.github.io/posts/booknotes/softwarefoundations/lf/lists/">
  <meta property="og:title" content="Working with Structured Data | Academic">
  <meta property="og:description" content="Pairs of Numbers Lists of Numbers Repeat Length Append Head ant Tail Bags via Lists Reasoning About Lists Induction on Lists Reversing a List Search Options Partial Maps Exercises Exercise: 1 star, standard (snd_fst_is_swap) Exercise: 1 star, standard, optional (fst_swap_is_snd) Exercise: 2 stars, standard, especially useful (list_funs) Exercise: 3 stars, advanced (alternate) Exercise: 3 stars, standard, especially useful (bag_functions) Exercise: 3 stars, standard, optional (bag_more_functions) Exercise: 2 stars, standard, especially useful (add_inc_count) Exercise: 3 stars, standard (list_exercises) Exercise: 2 stars, standard (eqblist) Exercise: 1 star, standard (count_member_nonzero) Exercise: 3 stars, advanced (remove_does_not_increase_count) Exercise: 3 stars, standard, optional (bag_count_sum) Exercise: 3 stars, advanced (involution_injective) Exercise: 2 stars, advanced (rev_injective) Exercise: 2 stars, standard (hd_error) Exercise: 1 star, standard, optional (option_elim_hd) Exercise: 1 star, standard (eqb_id_refl) Exercise: 1 star, standard (update_eq) Exercise: 1 star, standard (update_neq) Pairs of Numbers 我们可以定义一个 pair 类型："><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us">
  
    
    
  

  



  


  


  





  <title>Working with Structured Data | Academic</title>

  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Academic</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Academic</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/courses"><span>Courses</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/literature"><span>Literature</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/posts/booknotes/softwarefoundations/lf/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/posts/booknotes/softwarefoundations/lf/basics/">Chapters</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/posts/booknotes/softwarefoundations/lf/basics/">01: Basics</a>
      </li>
      
      <li >
        <a href="/posts/booknotes/softwarefoundations/lf/induction/">02: Induction</a>
      </li>
      
      <li class="active">
        <a href="/posts/booknotes/softwarefoundations/lf/lists/">03: Lists</a>
      </li>
      
      <li >
        <a href="/posts/booknotes/softwarefoundations/lf/poly/">04: Poly</a>
      </li>
      
      <li >
        <a href="/posts/booknotes/softwarefoundations/lf/tactics/">05: Tactics</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    

    <main class="col-12 col-md-9 col-xl-9 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>Working with Structured Data</h1>

          <div class="article-style">
            <ul>
<li>
<a href="#pairs-of-numbers">Pairs of Numbers</a></li>
<li>
<a href="#lists-of-numbers">Lists of Numbers</a>
<ul>
<li>
<a href="#repeat">Repeat</a></li>
<li>
<a href="#length">Length</a></li>
<li>
<a href="#append">Append</a></li>
<li>
<a href="#head-ant-tail">Head ant Tail</a></li>
<li>
<a href="#bags-via-lists">Bags via Lists</a></li>
</ul>
</li>
<li>
<a href="#reasoning-about-lists">Reasoning About Lists</a>
<ul>
<li>
<a href="#induction-on-lists">Induction on Lists</a></li>
<li>
<a href="#reversing-a-list">Reversing a List</a></li>
<li>
<a href="#search">Search</a></li>
</ul>
</li>
<li>
<a href="#options">Options</a></li>
<li>
<a href="#partial-maps">Partial Maps</a></li>
<li>
<a href="#exercises">Exercises</a>
<ul>
<li>
<a href="#exercise-1-star-standard-snd_fst_is_swap">Exercise: 1 star, standard (snd_fst_is_swap)</a></li>
<li>
<a href="#exercise-1-star-standard-optional-fst_swap_is_snd">Exercise: 1 star, standard, optional (fst_swap_is_snd)</a></li>
<li>
<a href="#exercise-2-stars-standard-especially-useful-list_funs">Exercise: 2 stars, standard, especially useful (list_funs)</a></li>
<li>
<a href="#exercise-3-stars-advanced-alternate">Exercise: 3 stars, advanced (alternate)</a></li>
<li>
<a href="#exercise-3-stars-standard-especially-useful-bag_functions">Exercise: 3 stars, standard, especially useful (bag_functions)</a></li>
<li>
<a href="#exercise-3-stars-standard-optional-bag_more_functions">Exercise: 3 stars, standard, optional (bag_more_functions)</a></li>
<li>
<a href="#exercise-2-stars-standard-especially-useful-add_inc_count">Exercise: 2 stars, standard, especially useful (add_inc_count)</a></li>
<li>
<a href="#exercise-3-stars-standard-list_exercises">Exercise: 3 stars, standard (list_exercises)</a></li>
<li>
<a href="#exercise-2-stars-standard-eqblist">Exercise: 2 stars, standard (eqblist)</a></li>
<li>
<a href="#exercise-1-star-standard-count_member_nonzero">Exercise: 1 star, standard (count_member_nonzero)</a></li>
<li>
<a href="#exercise-3-stars-advanced-remove_does_not_increase_count">Exercise: 3 stars, advanced (remove_does_not_increase_count)</a></li>
<li>
<a href="#exercise-3-stars-standard-optional-bag_count_sum">Exercise: 3 stars, standard, optional (bag_count_sum)</a></li>
<li>
<a href="#exercise-3-stars-advanced-involution_injective">Exercise: 3 stars, advanced (involution_injective)</a></li>
<li>
<a href="#exercise-2-stars-advanced-rev_injective">Exercise: 2 stars, advanced (rev_injective)</a></li>
<li>
<a href="#exercise-2-stars-standard-hd_error">Exercise: 2 stars, standard (hd_error)</a></li>
<li>
<a href="#exercise-1-star-standard-optional-option_elim_hd">Exercise: 1 star, standard, optional (option_elim_hd)</a></li>
<li>
<a href="#exercise-1-star-standard-eqb_id_refl">Exercise: 1 star, standard (eqb_id_refl)</a></li>
<li>
<a href="#exercise-1-star-standard-update_eq">Exercise: 1 star, standard (update_eq)</a></li>
<li>
<a href="#exercise-1-star-standard-update_neq">Exercise: 1 star, standard (update_neq)</a></li>
</ul>
</li>
</ul>
<h2 id="pairs-of-numbers">Pairs of Numbers</h2>
<p>我们可以定义一个 pair 类型：</p>
<pre><code class="language-plaintext">Inductive natprod : Type := 
  | pair (n1 n2 : nat).
Notation &quot;( x, y )&quot; := (pair x y).
</code></pre>
<p>以及一些辅助函数：</p>
<pre><code class="language-plaintext">Definition fst (p : natprod) : nat :=
  match p with
  | (x, y) =&gt; x
  end.
Definition snd (p : natprod) : nat :=
  match p with
  | (x, y) =&gt; y
  end.
Definition swap_pair(p : natprod) : nat :=
  match p with
  | (x, y) =&gt; (y, x)
  end.
</code></pre>
<p>这里值得注意的是在 pattern matching 中的 <code>(x, y)</code> 和 <code>x, y</code> 是不一样的：前者匹配的是一个 pair 类型，而后者匹配了两个东西。</p>
<p>下面看一个有意思的证明题：</p>
<pre><code class="language-plaintext">Theorem surjective_pairing : forall p : natprod, p = (fst p, snd p).
</code></pre>
<p>我们无法通过 <code>simpl</code> 直接证明该题，因为 p 的具体内容不知道，<code>fst p</code> <code>snd p</code> 无法化简。一个好的方法是使用 <code>destruct</code>：</p>
<pre><code class="language-plaintext">Proof.
  intros p. destruct p as [n m].
  simpl. reflexivity.
Qed.
</code></pre>
<p>这里的 destruct 不是用来分类讨论，而是其字面意思：给 <code>p</code> 一个形式，从而解构它。</p>
<h2 id="lists-of-numbers">Lists of Numbers</h2>
<p>我们定义一个链表类型：</p>
<pre><code class="language-plaintext">Inductive natlist : Type :=
  | nil
  | cons (n : nat) (l : natlist).
</code></pre>
<p>简单来说，每一个 natlist 类型的变量要么是 nil，要么是一个自然数和另一个 natlist。下面的一些 notation 让表示链表变得简单：</p>
<pre><code class="language-plaintext">Notation &quot;x :: l&quot; := (cons x l)
                     (at level 60, right associativity).
Notation &quot;[ ]&quot; := nil.
Notation &quot;[ x ; .. ; y]&quot; := (cons x .. (cons y nil) ..).
</code></pre>
<p>这里值得注意两点：</p>
<ul>
<li><code>::</code> 应当是右结合的，即 <code>1 :: 2 :: 3</code> 等价于 <code>1 :: (2 :: 3)</code>。</li>
<li><code>::</code> 的优先级低于加减法，即 <code>1 + 2 :: 3</code> 等价于 <code>(1 + 2) :: 3</code>。</li>
</ul>
<h3 id="repeat">Repeat</h3>
<p><code>repeat</code> 函数接收两个参数 <code>n</code> 和 <code>count</code>，返回一个长度为 <code>count</code>，每个节点都是 <code>n</code> 的链表：</p>
<pre><code class="language-plaintext">Fixpoint repeat (n count : nat) -&gt; natlist :=
  match count with
  | O =&gt; nil
  | S count' =&gt; n :: (repeat n count')
  end.
</code></pre>
<h3 id="length">Length</h3>
<p><code>length</code> 函数接收一个参数 <code>l</code>，返回链表 <code>l</code> 的长度。</p>
<pre><code class="language-plaintext">Fixpoint length (l : natlist) -&gt; nat :=
  match l with
  | nil =&gt; 0
  | h :: t =&gt; 1 + (length t)
  end.
</code></pre>
<h3 id="append">Append</h3>
<p><code>app</code> 函数用于把两个链表连接起来。</p>
<pre><code class="language-plaintext">Fixpoint app (l1 l2 : natlist) -&gt; natlist :=
  match l1 with
  | nil =&gt; l2
  | h :: t =&gt; h :: (app t l2)
  end.

Notation &quot;x ++ y&quot; := (app x y)
                     (right associativity, at level 60).
</code></pre>
<h3 id="head-ant-tail">Head ant Tail</h3>
<p><code>hd</code> 函数返回链表的第一个元素，<code>tl</code> 函数返回链条除了第一个元素以外的后面的部分。</p>
<pre><code class="language-plaintext">Definition hd (default : nat) (l : natlist) -&gt; nat :=
  match hd with
  | nil =&gt; default
  | h :: t =&gt; h
  end.
Definition tl (l : natlist) -&gt; natlist :=
  match tl with
  | nil =&gt; nil
  | h :: t =&gt; t
  end.
</code></pre>
<h3 id="bags-via-lists">Bags via Lists</h3>
<p>这里的 bag 指的是 multiset。我们可以用链表模拟 multiset。</p>
<h2 id="reasoning-about-lists">Reasoning About Lists</h2>
<p>List 的 match 定义让我们可以对于很多比较简单的命题直接使用 <code>reflexivity</code> 或者分类讨论解决。但稍复杂的问题还是要借助归纳法。</p>
<h3 id="induction-on-lists">Induction on Lists</h3>
<p>对于链表的归纳法和对于自然数的归纳法没有本质区别。只要使用 <code>Inductive</code> 的方式定义的类型都可以使用归纳法进行证明。下面是 <code>++</code> 具有结合律的一段证明：</p>
<pre><code class="language-plaintext">Theorem app_assoc : forall l1 l2 l3 : natlist,
  (l1 ++ l2) ++ l3 = l1 ++ (l2 ++ l3).
Proof.
  intros l1 l2 l3. induction l1 as [| n l1' IHl'].
  - (* l1 = nil *)
    reflexivity.
  - (* l1 = cons n l1' *)
    simpl. rewrite IHl'. reflexivity.
Qed.
</code></pre>
<h3 id="reversing-a-list">Reversing a List</h3>
<p>考虑如下的翻转链表的函数：</p>
<pre><code class="language-plaintext">Fixpoint rev (l : natlist) : natlist :=
  match l with
  | nil =&gt; nil
  | h :: t =&gt; (rev t) ++ [h]
  end.
</code></pre>
<p>下面我们尝试证明链表翻转后长度不变：</p>
<pre><code class="language-plaintext">Theorem rev_length : forall l : natlist, length (rev l) = length l.
</code></pre>
<p>如果直接使用数学归纳法证明，在 successor case 中，我们会被 <code>length(rev l' ++ [n]) = S (length (rev l'))</code> 这个结论卡住。因此我们需要先证明一个引理：链表结合后的长度等于结合前两个链表的长度之和。</p>
<pre><code class="language-plaintext">Theorem app_length : forall l1 l2 : natlist, length (l1 ++ l2) = (length l1) + (length l2).
Proof.
  intros l1 l2. induction l1 as [| n l1' IHl1'].
  - reflexivity.
  - simpl. rewrite IHl1'. reflexivity.
Qed.

Theorem rev_length : forall l : natlist, length (rev l) = length l.
Proof.
  intros l. induction l as [| n l' IHl'].
  - reflexivity.
  - simpl. rewrite app_length.
    simpl. rewrite IHl'. rewrite add_comm.
    reflexivity.
Qed.
</code></pre>
<h3 id="search">Search</h3>
<p>我们在证明的时候时常要使用之前证明过的引理，但使用这些引理需要知道它们的名字，如果现场不记得名字，可以使用 <code>Search name</code> 的方式来查找，Coq 会输出所有名字中带有 name 的引理。</p>
<p><code>Search</code> tactic 还支持更加丰富的查找功能，例如</p>
<pre><code class="language-plaintext">Search (_ + _ = _ + _) inside Induction. 
</code></pre>
<p>会在 Induction 模块中寻找符合上述形式的定理。</p>
<pre><code class="language-plaintext">Search (?x + ?y = ?y + ?x).
</code></pre>
<p>几乎可以直接锁定到加法交换律。这里变量前加一个 <code>?</code> 表示这是搜索时使用的 pattern，而不是在当前环境中要求存在的变量。</p>
<h2 id="options">Options</h2>
<p>这一章节讲述了 error handling 的重要性。假设我们要写一个函数返回链表的第 n 个元素，我们必须要考虑如果链表的长度小于 n 应当返回什么，如果我们这样写代码：</p>
<pre><code class="language-plaintext">Fixpoint nth_bad (l : natlist) (n : nat) : nat :=
  match l with
  | nil =&gt; 42
  | a :: l' =&gt; match n with
               | 0 ⇒ a
               | S n' ⇒ nth_bad l' n'
               end
  end.
</code></pre>
<p>那么如果函数返回了 42，我们必须再检查一遍链表才能确定究竟是链表太短了还是第 n 个元素正好是 42。一个好的方法是重新定义返回类型，在 error 时返回一个特殊的东西：</p>
<pre><code class="language-plaintext">Inductive natoption : Type :=
  | Some (n : nat)
  | None.
</code></pre>
<pre><code class="language-plaintext">Fixpoint nth_error (l : natlist) (n : nat) : natoption :=
  match l with
  | nil =&gt; None
  | a :: l' =&gt; match n with
               | O ⇒ Some a
               | S n' ⇒ nth_error l' n'
               end
  end.
</code></pre>
<p>之后我们还可以根据具体的情境来选择不同的不可能出现的值作为返回值：</p>
<pre><code class="language-plaintext">Definition option_elim (d : nat) (o : natoption) : nat :=
  match o with
  | Some n' =&gt; n'
  | None =&gt; d
  end.
</code></pre>
<h2 id="partial-maps">Partial Maps</h2>
<p>这一章介绍了用 Coq 定义 map 这一数据结构。map 本质上就是 key-value pair 的集合。这里我们先为 key 定义一个单独的类型 (没有什么特殊的作用，只是为了封装一下好看)：</p>
<pre><code class="language-plaintext">Inductive id : Type :=
  | Id (n : nat)
</code></pre>
<p>接下来我们定义 partial map:</p>
<pre><code class="language-plaintext">Inductive partial_map : Type :=
  | empty
  | record (i : id) (v : nat) (m : partial_map)
</code></pre>
<p>该定义的意思是：partial map 要么是 empty (空集)，要么是一个 key-value pair 接上另一个 partial map。</p>
<p>下面的 update 函数可以完成向 partial map 中添加一个 key-value pair 的功能：</p>
<pre><code class="language-plaintext">Definition update (d : partial_map) (x : id) (value : nat) -&gt; partial_map :=
  record x value d.
</code></pre>
<p>find 函数可以查询 partial map 中是否存在某个 id，并返回对应的 value：</p>
<pre><code class="language-plaintext">Fixpoint find (x : id) (d : partial_map) : natoption :=
  match d with
  | empty =&gt; None.
  | y v d' =&gt; if eqb_id x y
              then Some v
              else find x d'
  end.s
</code></pre>
<h2 id="exercises">Exercises</h2>
<h3 id="exercise-1-star-standard-snd_fst_is_swap">Exercise: 1 star, standard (snd_fst_is_swap)</h3>
<pre><code class="language-plaintext">Theorem snd_fst_is_swap : forall (p : natprod),
  (snd p, fst p) = swap_pair p.
Proof.
  intros p. destruct p as [n m].
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-1-star-standard-optional-fst_swap_is_snd">Exercise: 1 star, standard, optional (fst_swap_is_snd)</h3>
<pre><code class="language-plaintext">Theorem fst_swap_is_snd : forall (p : natprod),
  fst (swap_pair p) = snd p.
Proof.
  intros p. destruct p as [n m].
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-standard-especially-useful-list_funs">Exercise: 2 stars, standard, especially useful (list_funs)</h3>
<pre><code class="language-plaintext">Fixpoint nonzeros (l:natlist) : natlist :=
  match l with
  | nil =&gt; nil
  | O :: t =&gt; nonzeros t
  | S n :: t =&gt; S n :: (nonzeros t)
  end.

Example test_nonzeros:
  nonzeros [0;1;0;2;3;0;0] = [1;2;3].
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Fixpoint oddmembers (l:natlist) : natlist :=
  match l with
  | nil =&gt; nil
  | h :: t =&gt; if (even h) then (oddmembers t) else (h :: (oddmembers t))
  end.

Example test_oddmembers:
  oddmembers [0;1;0;2;3;0;0] = [1;3].
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Definition countoddmembers (l:natlist) : nat :=
  length (oddmembers l).

Example test_countoddmembers1:
  countoddmembers [1;0;3;1;4;5] = 4.
Proof. reflexivity. Qed.

Example test_countoddmembers2:
  countoddmembers [0;2;4] = 0.
Proof. reflexivity. Qed.

Example test_countoddmembers3:
  countoddmembers nil = 0.
Proof. reflexivity. Qed.
</code></pre>
<h3 id="exercise-3-stars-advanced-alternate">Exercise: 3 stars, advanced (alternate)</h3>
<pre><code class="language-plaintext">Fixpoint alternate (l1 l2 : natlist) : natlist :=
  match l1, l2 with
  | nil, nil =&gt; nil
  | nil, _ =&gt; l2
  | _, nil =&gt; l1
  | h1 :: t1, h2 :: t2 =&gt; h1 :: h2 :: (alternate t1 t2)
  end.

Example test_alternate1:
  alternate [1;2;3] [4;5;6] = [1;4;2;5;3;6].
Proof. reflexivity. Qed.

Example test_alternate2:
  alternate [1] [4;5;6] = [1;4;5;6].
Proof. reflexivity. Qed.

Example test_alternate3:
  alternate [1;2;3] [4] = [1;4;2;3].
Proof. reflexivity. Qed.

Example test_alternate4:
  alternate [] [20;30] = [20;30].
Proof. reflexivity. Qed.
</code></pre>
<h3 id="exercise-3-stars-standard-especially-useful-bag_functions">Exercise: 3 stars, standard, especially useful (bag_functions)</h3>
<pre><code class="language-plaintext">Fixpoint count (v : nat) (s : bag) : nat :=
  match s with
  | nil =&gt; 0
  | h :: t =&gt; if (v =? h) then 1 + (count v t) else (count v t)
  end.

Example test_count1:              count 1 [1;2;3;1;4;1] = 3.
Proof. reflexivity. Qed.
Example test_count2:              count 6 [1;2;3;1;4;1] = 0.
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Definition sum : bag -&gt; bag -&gt; bag := app.

Example test_sum1:              count 1 (sum [1;2;3] [1;4;1]) = 3.
Proof. reflexivity. Qed.
</code></pre>
<p>这里可以注意一下不显式给出参数名称的定义函数的方法。在这种情况下，我们只能把一个参数类型和返回值类型相同的函数赋给当前函数。</p>
<pre><code class="language-plaintext">Definition add (v : nat) (s : bag) : bag := v :: s.

Example test_add1:                count 1 (add 1 [1;4;1]) = 3.
Proof. reflexivity. Qed.
Example test_add2:                count 5 (add 1 [1;4;1]) = 0.
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Fixpoint member (v : nat) (s : bag) : bool :=
  match s with
  | nil =&gt; false
  | h :: t =&gt; if (v =? h) then true else (member v t)
  end.

Example test_member1:             member 1 [1;4;1] = true.
Proof. reflexivity. Qed.
Example test_member2:             member 2 [1;4;1] = false.
Proof. reflexivity. Qed.
</code></pre>
<h3 id="exercise-3-stars-standard-optional-bag_more_functions">Exercise: 3 stars, standard, optional (bag_more_functions)</h3>
<pre><code class="language-plaintext">Fixpoint remove_one (v : nat) (s : bag) : bag :=
  match s with
  | nil =&gt; nil
  | h :: t =&gt; if (h =? v) then t else (h :: (remove_one v t))
  end.

Example test_remove_one1:
  count 5 (remove_one 5 [2;1;5;4;1]) = 0.
Proof. reflexivity. Qed.

Example test_remove_one2:
  count 5 (remove_one 5 [2;1;4;1]) = 0.
Proof. reflexivity. Qed.

Example test_remove_one3:
  count 4 (remove_one 5 [2;1;4;5;1;4]) = 2.
Proof. reflexivity. Qed.

Example test_remove_one4:
  count 5 (remove_one 5 [2;1;5;4;5;1;4]) = 1.
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Fixpoint remove_all (v:nat) (s:bag) : bag :=
  match s with
  | nil =&gt; nil
  | h :: t =&gt; if (h =? v) then (remove_all v t) else (h :: (remove_all v t))
  end.

Example test_remove_all1:  count 5 (remove_all 5 [2;1;5;4;1]) = 0.
Proof. reflexivity. Qed.
Example test_remove_all2:  count 5 (remove_all 5 [2;1;4;1]) = 0.
Proof. reflexivity. Qed.
Example test_remove_all3:  count 4 (remove_all 5 [2;1;4;5;1;4]) = 2.
Proof. reflexivity. Qed.
Example test_remove_all4:  count 5 (remove_all 5 [2;1;5;4;5;1;4;5;1;4]) = 0.
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Fixpoint included (s1 : bag) (s2 : bag) : bool :=
  match s1 with
  | nil =&gt; true
  | h :: t =&gt; if ((count h s2) =? 0) then
                false
              else
                included t (remove_one h s2)
  end.

Example test_included1:              included [1;2] [2;1;4;1] = true.
Proof. reflexivity. Qed.
Example test_included2:              included [1;2;2] [2;1;4;1] = false.
Proof. reflexivity. Qed.
</code></pre>
<h3 id="exercise-2-stars-standard-especially-useful-add_inc_count">Exercise: 2 stars, standard, especially useful (add_inc_count)</h3>
<pre><code class="language-plaintext">Theorem add_inc_count : forall (v : nat) (s : bag),
  count v (add v s) = 1 + count v s.
Proof.
  intros. 
  simpl.
  rewrite eqb_refl. (* n =? n = true *)
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-3-stars-standard-list_exercises">Exercise: 3 stars, standard (list_exercises)</h3>
<pre><code class="language-plaintext">Theorem app_nil_r : forall l : natlist,
  l ++ [] = l.
Proof.
  intros l. induction l as [| n l' IHl'].
  - reflexivity.
  - simpl. rewrite IHl'. reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Theorem rev_app_distr: forall l1 l2 : natlist,
  rev (l1 ++ l2) = rev l2 ++ rev l1.
Proof.
  intros l1 l2.
  induction l1 as [|n l1' IHl1'].
  - rewrite app_nil_r. reflexivity.
  - simpl. 
    rewrite IHl1'. 
    rewrite app_assoc. 
    reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Theorem rev_involutive : forall l : natlist,
  rev (rev l) = l.
Proof.
  intros l.
  induction l as [| n l' IHl'].
  - reflexivity.
  - simpl. 
    rewrite rev_app_distr.
    rewrite IHl'.
    reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Theorem app_assoc4 : forall l1 l2 l3 l4 : natlist,
  l1 ++ (l2 ++ (l3 ++ l4)) = ((l1 ++ l2) ++ l3) ++ l4.
Proof.
  intros l1 l2 l3 l4.
  rewrite app_assoc.
  rewrite app_assoc.
  reflexivity.
Qed.
</code></pre>
<pre><code class="language-plaintext">Lemma nonzeros_app : forall l1 l2 : natlist,
  nonzeros (l1 ++ l2) = (nonzeros l1) ++ (nonzeros l2).
Proof.
  intros l1 l2.
  induction l1 as [| n l1' IHl1'].
  - reflexivity.
  - destruct n as [| n'] eqn:N.
    + simpl. rewrite IHl1'. reflexivity.
    + simpl. rewrite IHl1'. reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-standard-eqblist">Exercise: 2 stars, standard (eqblist)</h3>
<pre><code class="language-plaintext">Fixpoint eqblist (l1 l2 : natlist) : bool :=
  match l1, l2 with
  | nil, nil =&gt; true
  | nil, _ =&gt; false
  | _, nil =&gt; false
  | h1 :: t1, h2 :: t2 =&gt;
    if (h1 =? h2) then (eqblist t1 t2) else false
  end.

Example test_eqblist1 :
  (eqblist nil nil = true).
Proof. reflexivity. Qed.

Example test_eqblist2 :
  eqblist [1;2;3] [1;2;3] = true.
Proof. reflexivity. Qed.

Example test_eqblist3 :
  eqblist [1;2;3] [1;2;4] = false.
Proof. reflexivity. Qed.
</code></pre>
<pre><code class="language-plaintext">Theorem eqblist_refl : forall l:natlist,
  true = eqblist l l.
Proof.
  intros l.
  induction l as [| n l' IHl'].
  - (* l = nil *)
    reflexivity.
  - (* l = con n l' *)
    simpl. 
    rewrite eqb_refl. (* n =? n = true *)
    rewrite IHl'.
    reflexivity.
Qed.
</code></pre>
<h3 id="exercise-1-star-standard-count_member_nonzero">Exercise: 1 star, standard (count_member_nonzero)</h3>
<pre><code class="language-plaintext">Theorem count_member_nonzero : forall (s : bag),
  1 &lt;=? (count 1 (1 :: s)) = true.
Proof.
  intros s.
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-3-stars-advanced-remove_does_not_increase_count">Exercise: 3 stars, advanced (remove_does_not_increase_count)</h3>
<pre><code class="language-plaintext">Theorem remove_does_not_increase_count: forall (s : bag),
  (count 0 (remove_one 0 s)) &lt;=? (count 0 s) = true.
Proof.
  intros s.
  induction s as [| n s' IHs'].
  - reflexivity.
  - destruct n as [| n'] eqn:N.
    + simpl.
      rewrite leb_n_Sn.
      reflexivity.
    + simpl.
      rewrite IHs'.
      reflexivity.
Qed.
</code></pre>
<h3 id="exercise-3-stars-standard-optional-bag_count_sum">Exercise: 3 stars, standard, optional (bag_count_sum)</h3>
<pre><code class="language-plaintext">Theorem count_sum : forall (v : nat) (l1 l2 : bag),
  count v l1 + count v l2 = count v (sum l1 l2).
Proof.
  intros v l1 l2.
  induction l1 as [| n l1' IHl1'].
  - reflexivity.
  - simpl.
    destruct (v =? n) as [].
    + simpl. rewrite IHl1'. reflexivity.
    + rewrite IHl1'. reflexivity.
Qed.
</code></pre>
<p>这题一个值得注意的细节是：我们不方便利用 destruct 直接去讨论 n 是否等于 v，但我们可以通过讨论 <code>v =? n</code> 是 true 还是 false 来实现这一需求。</p>
<h3 id="exercise-3-stars-advanced-involution_injective">Exercise: 3 stars, advanced (involution_injective)</h3>
<pre><code class="language-plaintext">Theorem involution_injective : forall (f : nat -&gt; nat),
    (forall n : nat, n = f (f n)) -&gt; (forall n1 n2 : nat, f n1 = f n2 -&gt; n1 = n2).
Proof.
  intros f H1 n1 n2 H2.
  rewrite H1.
  rewrite &lt;- H2.
  rewrite &lt;- H1.
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-2-stars-advanced-rev_injective">Exercise: 2 stars, advanced (rev_injective)</h3>
<pre><code class="language-plaintext">Theorem rev_injective : forall (l1 l2 : natlist),
  rev l1 = rev l2 -&gt; l1 = l2.
Proof.
  intros l1 l2 H.
  rewrite &lt;- rev_involutive.
  rewrite &lt;- H.
  rewrite rev_involutive.
  reflexivity.
Qed.
</code></pre>
<p>该定理的证明具有一定的技巧性。如果直接对某个链表使用归纳法会比较繁琐。这里利用 involutive 定理 <code>l = rev (rev l)</code>先把 <code>l2</code> 换成 <code>rev (rev l2)</code>，再利用条件把 <code>rev l2</code> 换成 <code>rev l1</code>，最后换一个方向利用 involutive 完成证明。</p>
<h3 id="exercise-2-stars-standard-hd_error">Exercise: 2 stars, standard (hd_error)</h3>
<pre><code class="language-plaintext">Definition hd_error (l : natlist) : natoption :=
  match l with
  | nil =&gt; None
  | h :: t =&gt; (Some h)
  end.

Example test_hd_error1 : hd_error [] = None.
Proof. reflexivity. Qed.

Example test_hd_error2 : hd_error [1] = Some 1.
Proof. reflexivity. Qed.

Example test_hd_error3 : hd_error [5;6] = Some 5.
Proof. reflexivity. Qed.
</code></pre>
<h3 id="exercise-1-star-standard-optional-option_elim_hd">Exercise: 1 star, standard, optional (option_elim_hd)</h3>
<pre><code class="language-plaintext">Theorem option_elim_hd : forall (l:natlist) (default:nat),
  hd default l = option_elim default (hd_error l).
Proof.
  intros l d.
  destruct l as [| h l'] eqn:L.
  - reflexivity.
  - reflexivity.
Qed.
</code></pre>
<h3 id="exercise-1-star-standard-eqb_id_refl">Exercise: 1 star, standard (eqb_id_refl)</h3>
<pre><code class="language-plaintext">Theorem eqb_id_refl : forall x, eqb_id x x = true.
Proof.
  intros x.
  destruct x as [n].
  simpl.
  rewrite eqb_refl.
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-1-star-standard-update_eq">Exercise: 1 star, standard (update_eq)</h3>
<pre><code class="language-plaintext">Theorem update_eq :
  forall (d : partial_map) (x : id) (v: nat),
    find x (update d x v) = Some v.
Proof.
  intros d x v.
  simpl.
  destruct x as [x'].
  simpl.
  rewrite eqb_refl.
  reflexivity.
Qed.
</code></pre>
<h3 id="exercise-1-star-standard-update_neq">Exercise: 1 star, standard (update_neq)</h3>
<pre><code class="language-plaintext">Theorem update_neq :
  forall (d : partial_map) (x y : id) (o: nat),
    eqb_id x y = false -&gt; find x (update d y o) = find x d.
Proof.
  intros d x y o H.
  simpl.
  rewrite H.
  reflexivity.
Qed.
</code></pre>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/posts/booknotes/softwarefoundations/lf/induction/" rel="next">Proof by Indution</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/posts/booknotes/softwarefoundations/lf/poly/" rel="prev">Polymorphism and Higher-Order Functions</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on Jan 1, 0001</p>

          





  
  

<p class="edit-page">
  <a href="https://github.com/gcushen/hugo-academic/edit/master/content/posts/BookNotes/SoftwareFoundations/lf/lists.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          

        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    

    <span id="busuanzi_container_site_pv">
        Total Visit: <span id="busuanzi_value_site_pv"></span>
    </span>

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.f8eb5cb10262ef4a670903a5cb3e03ae.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
