---
layout: post
date: 2022-04-12
title: "AtCoder Beginner Contest 247 题解"
categories:
tags: [AtCoder, 动态规划, 并查集, FFT/NTT, 分治, 网络流]
mathjax: true
---

## A. Move Right

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_a)
* 给定长度为 4 的字符串，求右移一位后的结果。

<!-- more -->

### 题解

用字符串处理，输出 $0 s_0 s_1 s_2$ 是最简单的。

## B. Unique Nicknames

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_b)
* 有 $n$ 个人，每个人有 2 个名字，要求每个人选择一个名字，使得每个人选出的名字都不能和其他任何人的任何一个被选名字冲突，问是否可以做到。
* $n\leq 100$，名字长度不超过 10。

### 题解

对于每个人的每个名字，检查是否和别人的所有名字都不相同即可。

## C. 1 2 1 3 1 2 1

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_c)
* 令 $S_n$ 为字符串，$S_1=1$，$S_k=S_{k-1}+k+S_{k-1}$，打印 $S_n$。
* $n\leq 16$。

### 题解

递归打印即可。

## D. Cylinder

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_d)

* 给定一个队列，有 $n$ 次操作，每次操作是以下两种类型之一：

    * `1 x c` ：向队尾加入 $x$ 个写有数字 $c$ 的球。
    * `2 x`：从队头拿出 $x$ 个球，保证此时队列中有不少于 $x$ 个球。

    对于每个第二类操作，求拿出的所有球的数字之和。

* $n\leq 2\times 10^5$。

### 题解

用一个队列维护，每一次加球操作以一个 pair 的形式放到队列中，取球暴力取即可。因为不会有超过 $n$ 次加球操作，所以总时间复杂度为 $O(n)$。

## E. Max Min

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_e)
* 给定一个长度为 $n$ 的数列和两个数 $X,Y$，求满足 $\max_{i\in [l,r]}a_i=X$ 且 $\min_{i\in [l,r]}a_i=Y$ 的区间 $[l,r]$ 的个数。
* $n\leq 2\times 10^5$。

### 题解

我们可以将序列中的数分成 3 类：所有等于 $X$ 的数置为 0，等于 $Y$ 的数置为 1，在 $(Y,X)$ 区间中的数置为 2，不在 $[Y,X]$ 中的数置为 3。我们要找至少包含一个 0 一个 1 且不包含 3 的区间。

我们对每个位置 $i$ 记录 $nxt_{i,j}$ 表示从 $i$ 往右最近的 $j$ 的位置 ($j=0,1,2,3$)。我们枚举所有的左端点 $l$，然后$[\max(nxt_{l,0},nxt_{l,1}),nxt_{l,2})$ 集合内都是合法的右端点，$X=Y$ 的情况需要特殊处理。 

总时间复杂度 $O(n)$。

## F. Cards

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_f)
* 有 $n$ 张卡片，第 $i$ 张卡片正面写了 $a_i$，背面写了 $b_i$。$a$ 和 $b$ 数列各构成一个 $1\cdots n$ 的排列。问有多少种取牌的方案，使得取出的所有牌的正反面的所有数字覆盖了 $1\cdots n$ 的每一种。
* $n\leq 2\times 10^5$。

### 题解

考虑建图处理。对于一张正面是 $a_i$，背面是 $b_i$ 的卡片，在点 $a_i$ 和 $b_i$ 之间连一条边。因为正反面的数列都是 permutation，所以每个数字恰好出现两次 (有两条邻边)，我们构建的图是若干个环。我们选择一张卡片相当于选择一条边，于是问题转化为了求若干个环构成的图的边覆盖个数。连边并统计环的个数和环的长度的工作用并查集处理会比较方便。

对于长度为 $n$ 的环的边覆盖个数，可以考虑 dp 计数。令 $dp(i,0/1,0/1)$ 表示当前考虑到第 $i$ 条边，上一条边选了/没选，环上的最后一条边选了/没选的方案数。第三个状态决定了破环成链后第一条边/最后一条边是否必须选。最终对每个环把答案乘起来即可。

总时间复杂度可以做到 $O(n)$。如果使用并查集的话会多一个反阿克曼函数。

## G. Dream Team

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_g)
* 有 $n$ 个选手，第 $i$ 个选手来自大学 $A_i$，擅长任务 $B_i$，能力值为 $C_i$。现对所有可行的 $k\geq 1$，要求选出 $k$ 个选手，保证没有任何两个选手的大学和擅长的任务是相同的，并要最大化能力值。
* $n\leq 30000, 1\leq A_i,B_i\leq 150$。

### 题解

总人数是无关紧要的，我们只需要对每种可能的 $(A,B)$ pair 保留一个能力值最大的人即可。该问题可以转化成一个非常裸的费用流问题：对于来自 $A$，擅长 $B$，能力值为 $C$ 的选手，连一条从 $A$ 到 $B$，容量为 $1$，费用为 $C$ 的边，再添加超级源点和超级汇点之后，求最大费用流即可 (我们可以一个流量一个流量地跑费用流，从而获得各个 $k$ 的答案)。为了将最大费用流转化为最小费用流，可以统一将 $C$ 改为 $LIM-C$，其中 $LIM$ 是一个很大的数，统计答案时拿 $LIM\cdot k$ 减去费用即可。

## Ex. Rearranging Problem

### 题面描述

* [传送门](https://atcoder.jp/contests/abc247/tasks/abc247_h)
* 有 $n$ 个人，编号为 $i$ 的人身上有数字 $c_i$。现执行 $k$ 次操作，每次选两个人 $i$ 和 $j$，交换它们的位置。求有多少种操作结束时人的排列，使得第 $i$ 个位置上的人身上的数字和编号为 $i$ 的人身上的数字相同 (即人身上的数字构成的数列没有变)。
* $n\leq 2\times 10^5$，时限 4s。

### 题解

我们先不考虑人身上的数字，仅仅考虑人的位置构成的一个置换。考虑建图，设某个时刻，第 $i$ 个位置的人是编号为 $a_i$ 的人，我们连一条从 $i$ 到 $a_i$ 的边。可以看到我们获得的图一定是若干个环。

我们考虑交换两个人的位置会给这幅图带来什么影响。交换两个人的位置显然会改变图中两条边的指向。如果这两个人本来属于一个环，那么交换后这个环会裂成两个；如果这两个人本来属于两个环，那么交换后这两个环会合并。所以进行一次操作之后，图中的环的个数会 +1 或 -1。

稍加思考可以发现一个局面能否达到只和它对应的图中有多少个环有关。初始状态下的图是 $n$ 个自环。假设最终局面中一共有 $c$ 个环，我们容易看出：一个局面可以通过 $k$ 次交换达到当且仅当 $n-c\leq k$ 且 $k-(n-c)$ 是偶数 (到达个数后一次 +1 抵消一次 -1)。

我们现在转而对每个 $c=1,\cdots, n$ 计算最终有 $c$ 个环且人身上的数符合要求的排列的个数，我们容易发现人身上的数符合要求当且仅当处于一个环的人身上的数都一样。考虑动态规划：令 $dp(i,j)$ 表示当前考虑到第 $i$ 个人，当前一共有 $j$ 个环的方案数。有两种转移：

* 第 $i$ 个人开辟了一个新的环；
* 第 $i$ 个人加入到了之前的某个环中，注意为了使最终局面人身上的数字满足要求，$i$ 必须指向一个和自己数字相同的“位置”。

令 $C_i\triangleq|\\{j:c_j=c_i,1\leq j\leq i-1\\}|$，我们可以写出状态转移方程：
$$
dp(i,j)=dp(i-1,j-1)+dp(i-1,j)\cdot C_i
$$该转移方程其实是第一类斯特林数的推广形式：如果任意两个数可以处于同一个环中，这就是第一类斯特林数。暴力地做这个 dp 时间复杂度为 $O(n^2)$，不能接受，但注意到该 dp 方程可以写成生成函数的形式，令
$$
F_i(x)=\sum_{j=0}^\infty dp(i,j)x^j
$$则 $F_i(x)=F_{i-1}(x)\cdot (x+C_i)$。因此我们只要求 $F_n(x)=\prod_{i=1}^n(x+C_i)$ 的各项系数即可，该过程可以用分治 NTT 加速，从而将总时间复杂度降到 $O(n\log^2n)$。

